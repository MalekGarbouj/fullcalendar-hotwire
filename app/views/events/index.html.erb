<div data-controller="calendar" class="p-6 space-y-6">

  <!-- Header with title and new event button -->
  <div class="flex justify-between items-center">
    <h1 class="text-3xl font-semibold text-gray-800 flex items-center">
      <svg class="inline-block mr-2 w-6 h-6 text-gray-700" fill="currentColor" viewBox="-366.24 -366.24 1342.88 1342.88">…</svg>
      Calendrier
    </h1>
    <%= link_to 'Créer un événement', new_event_path(params: { event: { start: DateTime.current, end: 1.hour.from_now }}), data: { turbo_frame: 'popup' }, class: "inline-block rounded-lg py-2 px-4 bg-blue-600 text-white font-medium hover:bg-blue-700 transition" %>
  </div>

  <hr class="border-gray-300">

  <!-- Agent selector -->
  <div class="w-full max-w-xs">
    <label for="agent_id" class="block mb-1 text-sm font-medium text-gray-700">Sélectionner un agent</label>
    <%= select_tag "agent_id", options_for_select(@agents.map { |a| [a.name, a.id] }), class: "form-select w-full", data: { calendar_target: "agentsList", action: "change->calendar#setDefaultAgent" } %>
  </div>

  <!-- Main layout: Tasks + Calendar -->
  <div class="flex flex-col md:flex-row gap-6">
    
    <!-- Tasks Panel -->
    <div id="external-tasks" class="w-full md:w-1/4 bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Tâches non assignées</h2>

      <% @events.each do |event| %>
        <div 
          id="event-<%= event.id %>" 
          data-id="<%= event.id %>"  
          data-event='{
            "title": "<%= j event.title %>", 
          

            "starts_at": "<%= event.starts_at.strftime("%H:%M") %>", 
            "ends_at": "<%= event.ends_at.strftime("%H:%M") %>"
          }'
          class="fc-event mb-3 p-3 border rounded bg-gray-50 cursor-pointer hover:bg-gray-100 transition"
        >
          <div class="font-medium text-gray-800"><%= event.title %></div>
          <div class="text-sm text-gray-500"><%= event.starts_at %> – <%= event.ends_at %></div>
        </div>
      <% end %>
    </div>

    <!-- Calendar View -->
    <div class="flex-1 bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
      <div data-calendar-target="window"></div>
      <turbo-frame id="popup" data-calendar-target="popup" data-action="turbo:submit-end->calendar#refresh"></turbo-frame>
    </div>

  </div>
</div>
